<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>è£é£¾è–èª•æ¨¹</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
html,body{
  margin:0;
  padding:0;
  background:#0b1d3a;
  overflow:hidden;
  font-family:system-ui,-apple-system,sans-serif;
  color:#fff;
}
canvas{display:block}

/* å·¦å´é¢æ¿ */
.panel{
  position:fixed;
  left:16px;
  top:16px;
  width:230px;
  background:rgba(20,30,50,.9);
  border-radius:16px;
  padding:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
  z-index:10;
  font-size:14px;
}
.panel h3{margin:0 0 8px;font-size:16px}
.row{display:flex;align-items:center;margin:6px 0}
.row span{width:90px}
.row input{flex:1}

button,select,input[type=text]{
  width:100%;
  margin-top:6px;
  padding:6px;
  border-radius:8px;
  border:none;
  box-sizing:border-box;
}
button{background:#ffd86b;cursor:pointer}
.small{font-size:12px;opacity:.85}

/* å³ä¸Š */
.top-right{
  position:fixed;
  right:16px;
  top:16px;
  display:flex;
  gap:8px;
  z-index:10;
}
.icon-btn{
  padding:6px 10px;
  border-radius:8px;
  border:none;
  cursor:pointer;
}

/* ä½¿ç”¨èªªæ˜ */
.help{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:20;
}
.help .box{
  background:#fff;
  color:#000;
  max-width:520px;
  border-radius:16px;
  padding:20px;
}
</style>
</head>
<body>

<div class="panel">
  <h3>ğŸ¨ é¡è‰²è¨­å®š</h3>
  <div class="row"><span>ğŸŒ² æ¨¹è‘‰</span><input type="color" id="leafColor" value="#1f6b45"></div>
  <div class="row"><span>ğŸ€ å½©å¸¶</span><input type="color" id="ribbonColor" value="#d4af37"></div>
  <div class="row"><span>ğŸ”´ å°çƒ</span><input type="color" id="ballColor" value="#c0392b"></div>
  <div class="row"><span>ğŸ ç¦®ç‰©</span><input type="color" id="giftColor" value="#ff6fae"></div>
  <div class="row"><span>â­ æ˜Ÿæ˜Ÿ</span><input type="color" id="starColor" value="#fff2a8"></div>

  <button id="addGift">â• æ–°å¢ç¦®ç‰©</button>

  <hr <br>
  <input type="text" id="saveName" placeholder="å­˜æª”åç¨±">
  <button id="saveBtn">ğŸ’¾ å„²å­˜è¨­è¨ˆ</button>
  <select id="saveList"></select>
  <button id="loadBtn">ğŸ“‚ è¼‰å…¥è¨­è¨ˆ</button>

  <button id="exportBtn">ğŸ“¸ åŒ¯å‡º PNG</button>

  <div class="small">é»ç•«é¢æ–°å¢å°çƒ<br>Delete / Backspace åˆªé™¤</div>
</div>

<div class="top-right">
  <button class="icon-btn" id="helpBtn">ä½¿ç”¨èªªæ˜</button>
</div>

<div class="help" id="help">
  <div class="box">
    <h2>ğŸ„ ä½¿ç”¨èªªæ˜</h2>
    <ul>
      <li>é»ç•«é¢ä»»æ„è™•æ–°å¢å°çƒ</li>
      <li>æ‹–æ›³ç§»å‹•è£é£¾</li>
      <li>Delete / Backspace åˆªé™¤é¸å–ç‰©ä»¶</li>
      <li>å¯å„²å­˜å¤šå€‹è¨­è¨ˆä¸¦è¼‰å…¥</li>
    </ul>
    <button onclick="help.style.display='none'">é—œé–‰</button>
  </div>
</div>

<canvas id="c"></canvas>

<script>
/* ===== Canvas ===== */
const canvas=document.getElementById('c');
const ctx=canvas.getContext('2d');
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
addEventListener('resize',resize);resize();

const CX=()=>canvas.width/2;
const treeTop=150;
const layerGap=75;

/* ===== ç‹€æ…‹ ===== */
let balls=[], gifts=[];
let ribbons=[
  {y:treeTop+layerGap},
  {y:treeTop+layerGap*2},
  {y:treeTop+layerGap*3}
];

/* â„ï¸ é›ª */
const snow=Array.from({length:160},()=>({
  x:Math.random()*canvas.width,
  y:Math.random()*canvas.height,
  r:Math.random()*2+1,
  s:Math.random()*0.4+0.2
}));

/* â­ æ˜Ÿæ˜Ÿå‹•ç•« */
let starTime=0;

/* ===== å„²å­˜ / è¼‰å…¥ ===== */
function getState(){
  return {
    balls,
    gifts,
    ribbons,
    colors:{
      leaf:leafColor.value,
      ribbon:ribbonColor.value,
      ball:ballColor.value,
      gift:giftColor.value,
      star:starColor.value
    }
  };
}
function setState(s){
  balls=s.balls||[];
  gifts=s.gifts||[];
  ribbons=s.ribbons||ribbons;
  if(s.colors){
    leafColor.value=s.colors.leaf;
    ribbonColor.value=s.colors.ribbon;
    ballColor.value=s.colors.ball;
    giftColor.value=s.colors.gift;
    starColor.value=s.colors.star;
  }
}

function refreshSaveList(){
  saveList.innerHTML='';
  Object.keys(localStorage)
    .filter(k=>k.startsWith('tree_'))
    .forEach(k=>{
      const opt=document.createElement('option');
      opt.value=k;
      opt.textContent=k.replace('tree_','');
      saveList.appendChild(opt);
    });
}
refreshSaveList();

saveBtn.onclick=()=>{
  const name=saveName.value.trim();
  if(!name)return alert('è«‹è¼¸å…¥å­˜æª”åç¨±');
  localStorage.setItem('tree_'+name,JSON.stringify(getState()));
  refreshSaveList();
};

loadBtn.onclick=()=>{
  const key=saveList.value;
  if(!key)return;
  setState(JSON.parse(localStorage.getItem(key)));
};

/* ===== äº’å‹• ===== */
canvas.onclick=e=>{
  balls.push({x:e.offsetX,y:e.offsetY});
};

addGift.onclick=()=>{
  gifts.push({x:CX(),y:treeTop+layerGap*4});
};

/* ===== äº”è§’æ˜Ÿ ===== */
function drawStar(cx,cy,outer,inner){
  ctx.beginPath();
  for(let i=0;i<10;i++){
    const r=i%2===0?outer:inner;
    const a=Math.PI/2+i*Math.PI/5;
    ctx.lineTo(cx+Math.cos(a)*r,cy-Math.sin(a)*r);
  }
  ctx.closePath();
  ctx.fill();
}

/* ===== ç¹ªè£½ ===== */
function drawTree(){
  ctx.fillStyle=leafColor.value;
  [0,1,2].forEach(i=>{
    const y=treeTop+i*layerGap;
    const w=220+i*90;
    ctx.beginPath();
    ctx.moveTo(CX()-w/2,y);
    ctx.quadraticCurveTo(CX(),y-55,CX()+w/2,y);
    ctx.quadraticCurveTo(CX(),y+55,CX()-w/2,y);
    ctx.fill();
  });
  ctx.fillStyle='#8b5a2b';
  ctx.fillRect(CX()-22,treeTop+layerGap*3-20,44,110);
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* é›ª */
  ctx.fillStyle='white';
  snow.forEach(s=>{
    s.y+=s.s;
    if(s.y>canvas.height){s.y=-5;s.x=Math.random()*canvas.width}
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  });

  /* æ˜Ÿæ˜Ÿ */
  starTime+=0.03;
  ctx.save();
  ctx.fillStyle=starColor.value;
  ctx.shadowColor=starColor.value;
  ctx.shadowBlur=12+Math.sin(starTime)*6;
  drawStar(CX(),treeTop-30,16,7);
  ctx.restore();

  drawTree();

  ctx.strokeStyle=ribbonColor.value;
  ribbons.forEach(r=>{
    ctx.beginPath();
    ctx.moveTo(CX()-160,r.y);
    ctx.quadraticCurveTo(CX(),r.y-22,CX()+160,r.y);
    ctx.stroke();
  });

  ctx.fillStyle=ballColor.value;
  balls.forEach(b=>{
    ctx.beginPath();
    ctx.arc(b.x,b.y,8,0,Math.PI*2);
    ctx.fill();
  });

  ctx.fillStyle=giftColor.value;
  gifts.forEach(g=>{
    ctx.fillRect(g.x-16,g.y-16,32,32);
  });

  requestAnimationFrame(draw);
}
draw();

helpBtn.onclick=()=>help.style.display='flex';
exportBtn.onclick=()=>{
  const a=document.createElement('a');
  a.download='tree.png';
  a.href=canvas.toDataURL();
  a.click();
};
</script>
</body>
</html>
