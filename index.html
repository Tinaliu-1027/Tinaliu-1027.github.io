<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>è£é£¾è–èª•æ¨¹</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body{
    margin:0;
    background:#0b1d3a;
    overflow:hidden;
    font-family:system-ui,-apple-system,sans-serif;
    color:white;
  }
  .controls{
    position:fixed;
    left:20px;
    top:20px;
    background:rgba(20,30,50,.8);
    padding:16px;
    border-radius:16px;
    z-index:10;
    font-size:14px;
    box-shadow:0 8px 20px rgba(0,0,0,.4);
  }
  .controls label{display:block;margin-top:8px}
  button{
    margin-top:10px;
    padding:6px 10px;
    border-radius:8px;
    border:none;
    background:#ffd86b;
    cursor:pointer;
  }
</style>
</head>

<body>

<div class="controls">
  <strong>ğŸ„ è£é£¾è–èª•æ¨¹</strong>
  <label>æ¨¹è‘‰ <input type="color" id="leaf" value="#1f6b45"></label>
  <label>å°çƒ <input type="color" id="ball" value="#c0392b"></label>
  <label>å½©å¸¶ <input type="color" id="ribbon" value="#d4af37"></label>
  <label>æ˜Ÿæ˜Ÿ <input type="color" id="star" value="#fff2a8"></label>
  <label>ç¦®ç‰© <input type="color" id="gift" value="#ff6fae"></label>
  <button onclick="saveImage()">ğŸ“¸ å­˜æˆåœ–ç‰‡</button>
</div>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

const leaf = document.getElementById("leaf");
const ballColor = document.getElementById("ball");
const ribbon = document.getElementById("ribbon");
const star = document.getElementById("star");
const giftColor = document.getElementById("gift");

const CX = () => canvas.width / 2;

// â­ æ˜Ÿæ˜Ÿå‹•ç•«
let starPulse = 1, dir = 0.01;

// ğŸ”´ è£é£¾å°çƒï¼ˆå¯æ–°å¢ã€æ‹–æ›³ï¼‰
const balls = [
  { x: -50, y: 270, r: 9 },
  { x: 40, y: 320, r: 9 },
  { x: -10, y: 360, r: 9 }
];

// ğŸ ç¦®ç‰©ï¼ˆå¯æ‹–æ›³ï¼‰
const gifts = [
  { x: -60, y: 470, w: 40, h: 30 },
  { x: 0, y: 470, w: 40, h: 30 },
  { x: 60, y: 470, w: 40, h: 30 }
];

// â„ é›ª
const snow = Array.from({length:150}, () => ({
  x: Math.random() * innerWidth,
  y: Math.random() * innerHeight,
  r: Math.random() * 2 + 1,
  s: Math.random() * 0.6 + 0.3
}));

let dragging = null;

// ğŸ–± æ»‘é¼ æŒ‰ä¸‹ï¼ˆæ–°å¢ / æ‹–æ›³ï¼‰
canvas.onmousedown = e => {
  const mx = e.offsetX;
  const my = e.offsetY;
  dragging = null;

  // å°çƒï¼ˆå¾æœ€ä¸Šå±¤ï¼‰
  for (let i = balls.length - 1; i >= 0; i--) {
    const b = balls[i];
    if (Math.hypot(mx - (CX() + b.x), my - b.y) < b.r + 5) {
      dragging = b;
      return;
    }
  }

  // ç¦®ç‰©
  for (let g of gifts) {
    if (
      mx > CX() + g.x - g.w / 2 &&
      mx < CX() + g.x + g.w / 2 &&
      my > g.y &&
      my < g.y + g.h
    ) {
      dragging = g;
      return;
    }
  }

  // æ–°å¢å°çƒ
  const newBall = { x: mx - CX(), y: my, r: 9 };
  balls.push(newBall);
  dragging = newBall;
};

// ğŸ–± æ‹–æ›³ç§»å‹•
canvas.onmousemove = e => {
  if (!dragging) return;
  dragging.x = e.offsetX - CX();
  dragging.y = e.offsetY;
};

canvas.onmouseup = () => dragging = null;
canvas.onmouseleave = () => dragging = null;

// ğŸŒ² æ¨¹è‘‰å±¤
function leafLayer(y,w,h,color,blur){
  ctx.fillStyle = color;
  ctx.shadowColor = "rgba(0,0,0,.4)";
  ctx.shadowBlur = blur;
  ctx.beginPath();
  ctx.moveTo(CX() - w/2, y);
  ctx.quadraticCurveTo(CX(), y - h, CX() + w/2, y);
  ctx.quadraticCurveTo(CX(), y + h*0.7, CX() - w/2, y);
  ctx.fill();
}

// ğŸ¨ é¡è‰²æ·±æ·º
function shade(col, p){
  const n = parseInt(col.slice(1), 16);
  return `rgb(${(n>>16)+p},${(n>>8&255)+p},${(n&255)+p})`;
}

// ğŸ€ è´è¶çµ
function drawBow(cx,cy,color){
  ctx.fillStyle = color;
  ctx.shadowBlur = 4;
  ctx.beginPath();
  ctx.ellipse(cx-6,cy,6,4,0,0,Math.PI*2);
  ctx.ellipse(cx+6,cy,6,4,0,0,Math.PI*2);
  ctx.fill();
  ctx.beginPath();
  ctx.arc(cx,cy,3,0,Math.PI*2);
  ctx.fill();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // â­ æ˜Ÿæ˜Ÿ
  starPulse += dir;
  if (starPulse > 1.25 || starPulse < 0.8) dir *= -1;
  ctx.save();
  ctx.translate(CX(),140);
  ctx.scale(starPulse,starPulse);
  ctx.shadowColor = star.value;
  ctx.shadowBlur = 25;
  ctx.fillStyle = star.value;
  ctx.beginPath();
  for(let i=0;i<5;i++){
    ctx.lineTo(Math.cos((18+i*72)*Math.PI/180)*14,
               -Math.sin((18+i*72)*Math.PI/180)*14);
    ctx.lineTo(Math.cos((54+i*72)*Math.PI/180)*6,
               -Math.sin((54+i*72)*Math.PI/180)*6);
  }
  ctx.fill();
  ctx.restore();

  // ğŸŒ² æ¨¹è‘‰
  leafLayer(190,180,60,shade(leaf.value,-30),6);
  leafLayer(250,240,70,shade(leaf.value,-10),10);
  leafLayer(330,310,80,leaf.value,14);
  ctx.shadowBlur = 0;

  // ğŸ€ å½©å¸¶ï¼ˆç¬¦åˆæ¨¹å¤§å°ï¼‰
  const ribbonLayers = [
    { y: 245, w: 180 },
    { y: 295, w: 240 },
    { y: 345, w: 310 }
  ];
  ctx.strokeStyle = ribbon.value;
  ctx.lineWidth = 4;
  ribbonLayers.forEach(l => {
    ctx.beginPath();
    ctx.moveTo(CX() - l.w/2, l.y);
    ctx.quadraticCurveTo(CX(), l.y - 20, CX() + l.w/2, l.y);
    ctx.stroke();
  });

  // ğŸ”´ å°çƒ
  balls.forEach(b => {
    ctx.shadowColor = "rgba(255,255,255,.6)";
    ctx.shadowBlur = 12;
    ctx.fillStyle = ballColor.value;
    ctx.beginPath();
    ctx.arc(CX()+b.x, b.y, b.r, 0, Math.PI*2);
    ctx.fill();

    ctx.shadowBlur = 0;
    ctx.fillStyle = "rgba(255,255,255,.35)";
    ctx.beginPath();
    ctx.arc(CX()+b.x-3, b.y-3, b.r/3, 0, Math.PI*2);
    ctx.fill();
  });

  // ğŸªµ æ¨¹å¹¹
  ctx.fillStyle="#8b5a2b";
  ctx.fillRect(CX()-18,390,36,90);

  // ğŸ ç¦®ç‰©
  gifts.forEach(g => {
    ctx.shadowColor="rgba(0,0,0,.4)";
    ctx.shadowBlur=6;
    ctx.fillStyle=giftColor.value;
    ctx.fillRect(CX()+g.x-g.w/2,g.y,g.w,g.h);
    drawBow(CX()+g.x,g.y-4,ribbon.value);
  });

  // â„ é›ª
  ctx.fillStyle="white";
  snow.forEach(s=>{
    s.y+=s.s;
    if(s.y>canvas.height)s.y=0;
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  });

  requestAnimationFrame(draw);
}
draw();

// ğŸ“¸ å­˜åœ–
function saveImage(){
  const a=document.createElement("a");
  a.download="christmas-tree.png";
  a.href=canvas.toDataURL();
  a.click();
}
</script>

</body>
</html>
