<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tina æ­£éŸ³ç­ï½œæ°¸ä¹…ç¤ºç¯„éŸ³ç‰ˆ</title>
<style>
body{font-family:"Microsoft JhengHei",sans-serif;background:#fdf6f0;margin:0}
header{background:#ffb6b9;color:#fff;padding:20px;text-align:center;font-size:26px;font-weight:bold}
main{max-width:900px;margin:auto;padding:20px}
h2{color:#ff4c4c}
.levels button{margin:5px;padding:10px 18px;border:none;background:#ffb6b9;color:#fff;border-radius:6px}
.card{background:#fff;padding:15px;border-radius:10px;margin-bottom:20px;position:relative}
audio{width:100%;margin-top:8px}
.lock{background:#ffe0e0;padding:12px;border-radius:10px;margin-top:30px}
.computer-only{background:#fff4f4;padding:10px;border-radius:8px;margin-top:10px}
@media(max-width:768px){.computer-only{display:none}}
footer{text-align:center;padding:15px;background:#ffb6b9;color:white}
</style>
</head>
<body>

<header>ğŸ¤ Tina æ­£éŸ³ç­ï½œæ°¸ä¹…ç¤ºç¯„éŸ³</header>
<main>

<h2>åˆ†ç´šæŒ‘æˆ°</h2>
<div class="levels">
  <button onclick="show('easy')">ç°¡å–®</button>
  <button onclick="show('medium')">ä¸­ç­‰</button>
  <button onclick="show('hard')">å›°é›£</button>
</div>
<div id="list"></div>

<h2>ğŸ”’ Tina è€å¸«å°ˆç”¨ï¼ˆæ–°å¢ç¹å£ä»¤ï¼‹ç¤ºç¯„ï¼‰</h2>
<div class="lock">
<input type="password" id="pwd" placeholder="è¼¸å…¥å¯†ç¢¼">
<button onclick="unlock()">è§£é–</button>
<div id="teacher" style="display:none">
<p>é›£åº¦ï¼š
<select id="newLevel">
<option value="easy">ç°¡å–®</option>
<option value="medium">ä¸­ç­‰</option>
<option value="hard">å›°é›£</option>
</select></p>
<textarea id="newText" placeholder="è¼¸å…¥ç¹å£ä»¤" rows="3" style="width:100%"></textarea>
<p>ç¤ºç¯„éŒ„éŸ³ï¼š</p>
<input type="file" accept="audio/*" id="newAudio">
<br><br>
<button onclick="addTwister()">â• æ–°å¢</button>
</div>
</div>

</main>

<footer>Â© Tina æ­£éŸ³ç­</footer>

<script>
// è³‡æ–™çµæ§‹
let data={easy:[],medium:[],hard:[]};
let current="easy";

// è®€å– localStorage
function loadData(){
  const d = JSON.parse(localStorage.getItem("tinaData")||'{}');
  if(d.easy) data.easy=d.easy;
  if(d.medium) data.medium=d.medium;
  if(d.hard) data.hard=d.hard;
}

// å„²å­˜ localStorage
function saveData(){
  localStorage.setItem("tinaData", JSON.stringify(data));
}

// é¡¯ç¤ºæŒ‡å®šåˆ†ç´š
function show(level){
  current=level;
  const list=document.getElementById("list");
  list.innerHTML="";
  data[level].forEach((t,i)=>{
    list.innerHTML+=`
    <div class="card">
      <p>${t.text}</p>
      <p>ğŸ§ Tina ç¤ºç¯„</p>
      ${t.demo?`<audio controls src="${t.demo}"></audio>
      <a href="${t.demo}" download="${t.text}.mp3">â¬‡ï¸ ä¸‹è¼‰ç¤ºç¯„éŸ³</a>`:`<p>ï¼ˆå°šæœªä¸Šå‚³ç¤ºç¯„ï¼‰</p>`}
      <p>ğŸ¤ å­¸å“¡éŒ„éŸ³</p>
      <input type="file" accept="audio/*" onchange="playStudent(event,this)">
      <div class="computer-only">
        <button onclick="startRec(${i})">ğŸ™ï¸ éŒ„éŸ³</button>
        <button onclick="stopRec()">â¹ åœæ­¢</button>
        <audio id="pb-${i}" controls></audio>
      </div>
    </div>`;
  });
}

// å­¸å“¡æ’­æ”¾
function playStudent(e,input){
  const a=document.createElement("audio");
  a.controls=true;
  a.src=URL.createObjectURL(e.target.files[0]);
  input.after(a);
}

// Tina å¯†ç¢¼è§£é–
function unlock(){
  if(document.getElementById("pwd").value==="981027"){
    document.getElementById("teacher").style.display="block";
  } else alert("å¯†ç¢¼éŒ¯èª¤");
}

// Tina æ–°å¢é¡Œç›®
function addTwister(){
  const lv=document.getElementById("newLevel").value;
  const text=document.getElementById("newText").value.trim();
  const file=document.getElementById("newAudio").files[0];
  if(!text||!file){alert("æ–‡å­—èˆ‡éŒ„éŸ³éƒ½è¦");return;}

  const reader = new FileReader();
  reader.onload = function(e){
    const base64 = e.target.result; // å°‡æª”æ¡ˆè½‰æˆ base64
    data[lv].push({text:text,demo:base64});
    saveData();
    show(lv);
  };
  reader.readAsDataURL(file);

  document.getElementById("newText").value="";
  document.getElementById("newAudio").value="";
}

// é›»è…¦éŒ„éŸ³
let rec,chunks=[],idx=0;
async function startRec(i){
  idx=i;
  const s=await navigator.mediaDevices.getUserMedia({audio:true});
  rec=new MediaRecorder(s);
  chunks=[];
  rec.ondataavailable=e=>chunks.push(e.data);
  rec.onstop=()=>{
    document.getElementById(`pb-${idx}`).src=URL.createObjectURL(new Blob(chunks));
  };
  rec.start();
}
function stopRec(){rec.stop();}

// åˆå§‹åŒ–
loadData();
show("easy");
</script>

</body>
</html>
