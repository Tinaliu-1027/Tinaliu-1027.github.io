<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>è£é£¾è–èª•æ¨¹</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  background:#0b1d3a;
  overflow:hidden;
  font-family:system-ui,-apple-system,sans-serif;
  color:white;
}
.controls{
  position:fixed;
  left:20px;
  top:20px;
  background:rgba(20,30,50,.8);
  padding:16px;
  border-radius:16px;
  z-index:10;
  font-size:14px;
}
.controls label{display:block;margin-top:8px}
button{
  margin-top:10px;
  padding:6px 10px;
  border-radius:8px;
  border:none;
  background:#ffd86b;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="controls">
  <strong>ğŸ„ è£é£¾è–èª•æ¨¹</strong>
  <label>æ¨¹è‘‰ <input type="color" id="leaf" value="#1f6b45"></label>
  <label>å°çƒ <input type="color" id="ball" value="#c0392b"></label>
  <label>å½©å¸¶ <input type="color" id="ribbon" value="#d4af37"></label>
  <label>æ˜Ÿæ˜Ÿ <input type="color" id="star" value="#fff2a8"></label>
  <label>ç¦®ç‰© <input type="color" id="gift" value="#ff6fae"></label>
  <button onclick="saveImage()">ğŸ“¸ å­˜æˆåœ–ç‰‡</button>
</div>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

const leaf = document.getElementById("leaf");
const ballColor = document.getElementById("ball");
const ribbon = document.getElementById("ribbon");
const star = document.getElementById("star");
const giftColor = document.getElementById("gift");
const CX = () => canvas.width/2;

let starPulse=1,dir=0.01;
const balls=[];
let dragging=null;

// â„ é›ª
const snow=Array.from({length:150},()=>({
  x:Math.random()*innerWidth,
  y:Math.random()*innerHeight,
  r:Math.random()*2+1,
  s:Math.random()*0.6+0.3
}));

// ğŸ ç¦®ç‰©
const gifts=[
  {x:-60,y:470,w:40,h:30},
  {x:0,y:470,w:40,h:30},
  {x:60,y:470,w:40,h:30}
];

// ğŸ” çµ±ä¸€å–å¾—åº§æ¨™ï¼ˆæ»‘é¼  / è§¸æ§ï¼‰
function getPos(e){
  if(e.touches){
    const rect = canvas.getBoundingClientRect();
    return {
      x: e.touches[0].clientX - rect.left,
      y: e.touches[0].clientY - rect.top
    };
  }
  return {x:e.offsetX, y:e.offsetY};
}

// ğŸ–± / ğŸ“± é–‹å§‹
function start(e){
  const {x,y} = getPos(e);

  for(let i=balls.length-1;i>=0;i--){
    const b=balls[i];
    if(Math.hypot(x-(CX()+b.x),y-b.y)<b.r){
      dragging=b;
      return;
    }
  }
  balls.push({x:x-CX(),y:y,r:9});
}

// ğŸ–± / ğŸ“± ç§»å‹•
function move(e){
  if(!dragging) return;
  const {x,y} = getPos(e);
  dragging.x = x-CX();
  dragging.y = y;
  e.preventDefault();
}

// ğŸ–± / ğŸ“± æ”¾é–‹
function end(){
  dragging=null;
}

// æ»‘é¼ 
canvas.addEventListener("mousedown",start);
canvas.addEventListener("mousemove",move);
canvas.addEventListener("mouseup",end);

// è§¸æ§
canvas.addEventListener("touchstart",start,{passive:false});
canvas.addEventListener("touchmove",move,{passive:false});
canvas.addEventListener("touchend",end);

// âŒ¨ Backspace åˆªé™¤
addEventListener("keydown",e=>{
  if(e.key==="Backspace" && balls.length){
    balls.pop();
    e.preventDefault();
  }
});

// ğŸŒ² æ¨¹è‘‰
function leafLayer(y,w,h,color){
  ctx.fillStyle=color;
  ctx.beginPath();
  ctx.moveTo(CX()-w/2,y);
  ctx.quadraticCurveTo(CX(),y-h,CX()+w/2,y);
  ctx.quadraticCurveTo(CX(),y+h*0.7,CX()-w/2,y);
  ctx.fill();
}

// ğŸ€ è´è¶çµ
function drawBow(cx,cy,color){
  ctx.fillStyle=color;
  ctx.beginPath();ctx.ellipse(cx-6,cy,6,4,0,0,Math.PI*2);ctx.fill();
  ctx.beginPath();ctx.ellipse(cx+6,cy,6,4,0,0,Math.PI*2);ctx.fill();
  ctx.beginPath();ctx.arc(cx,cy,3,0,Math.PI*2);ctx.fill();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // â­ æ˜Ÿæ˜Ÿ
  starPulse+=dir;
  if(starPulse>1.25||starPulse<0.8)dir*=-1;
  ctx.save();
  ctx.translate(CX(),155);
  ctx.scale(starPulse,starPulse);
  ctx.fillStyle=star.value;
  ctx.beginPath();
  for(let i=0;i<5;i++){
    ctx.lineTo(Math.cos((18+i*72)*Math.PI/180)*14,
               -Math.sin((18+i*72)*Math.PI/180)*14);
    ctx.lineTo(Math.cos((54+i*72)*Math.PI/180)*6,
               -Math.sin((54+i*72)*Math.PI/180)*6);
  }
  ctx.fill();
  ctx.restore();

  // ğŸªµ æ¨¹å¹¹ï¼ˆåœ¨åº•å±¤ï¼‰
  ctx.fillStyle="#8b5a2b";
  ctx.fillRect(CX()-18,300,36,160);

  // ğŸŒ² æ¨¹è‘‰
  leafLayer(190,160,50,leaf.value);
  leafLayer(245,230,65,leaf.value);
  leafLayer(310,300,80,leaf.value);

  // ğŸ€ å½©å¸¶ï¼ˆä¸‰å±¤ï¼Œç¬¦åˆæ¨¹å¤§å°ï¼‰
ctx.strokeStyle = ribbon.value;
ctx.lineWidth = 4;
[
  [215, 80],   // æœ€ä¸Šå±¤
  [255,110],  // ä¸­å±¤
  [315,150]   // æœ€ä¸‹å±¤
].forEach(([y,w])=>{
  ctx.beginPath();
  ctx.moveTo(CX()-w,y);
  ctx.quadraticCurveTo(CX(),y-18,CX()+w,y);
  ctx.stroke();
});

  // ğŸ”´ å°çƒ
  balls.forEach(b=>{
    ctx.fillStyle=ballColor.value;
    ctx.beginPath();
    ctx.arc(CX()+b.x,b.y,b.r,0,Math.PI*2);
    ctx.fill();
  });

  // ğŸ ç¦®ç‰©
  gifts.forEach(g=>{
    ctx.fillStyle=giftColor.value;
    ctx.fillRect(CX()+g.x-g.w/2,g.y,g.w,g.h);
    drawBow(CX()+g.x,g.y-4,ribbon.value);
  });

  // â„ é›ª
  ctx.fillStyle="white";
  snow.forEach(s=>{
    s.y+=s.s;
    if(s.y>canvas.height)s.y=0;
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  });

  requestAnimationFrame(draw);
}
draw();

function saveImage(){
  const a=document.createElement("a");
  a.download="christmas-tree.png";
  a.href=canvas.toDataURL();
  a.click();
}
</script>

</body>
</html>
