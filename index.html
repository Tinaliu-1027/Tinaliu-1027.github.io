<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è£é£¾è–èª•æ¨¹</title>
  <style>
    body { margin:0; font-family:Arial; background:#0b1c3d; color:white; display:flex; }
    #controls { width:280px; padding:15px; background:rgba(0,0,0,0.45); }
    #controls h2 { margin-top:0; }
    label { display:block; margin-top:10px; font-size:14px; }
    input, button { width:100%; margin-top:5px; }
    canvas { flex:1; }
  </style>
</head>
<body>
<div id="controls">
  <h2>è£é£¾é¸å–®</h2>
  <label>æ¨¹å¹¹é¡è‰²<input type="color" id="trunkColor" value="#8b5a2b"></label>
  <label>æ¨¹è‘‰é¡è‰²<input type="color" id="leafColor" value="#0b8f3a"></label>
  <label>å°çƒé¡è‰²<input type="color" id="ballColor" value="#ff3333"></label>
  <button onclick="addBall()">æ–°å¢å°çƒï¼ˆå¯æ‹–æ›³ï¼‰</button>
  <label>å½©å¸¶é¡è‰²<input type="color" id="ribbonColor" value="#ffd700"></label>
  <label>æ˜Ÿæ˜Ÿé¡è‰²<input type="color" id="starColor" value="#ffff66"></label>
  <label>ç¦®ç‰©é¡è‰²<input type="color" id="giftColor" value="#00ccff"></label>
  <button onclick="addGift()">æ–°å¢ç¦®ç‰©ï¼ˆå¯æ‹–æ›³ï¼‰</button>
  <button onclick="resetAll()">é‡ç½®è¨­è¨ˆ</button>
  <button onclick="saveImage()">å„²å­˜æˆåœ–ç‰‡</button>
  <button onclick="toggleMusic()">ğŸµ è–èª•éŸ³æ¨‚</button>
</div>
<canvas id="scene"></canvas>
<audio id="music" loop src="https://cdn.pixabay.com/audio/2022/12/06/audio_7c92fdcdb3.mp3"></audio>
<script>
const canvas = document.getElementById('scene');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth - 280;
canvas.height = window.innerHeight;

let balls = [];
let gifts = [];
let snowflakes = [];
let dragging = null;
let starBlink = 0;

for (let i=0;i<150;i++) snowflakes.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*3+1,s:Math.random()+0.5});

function addBall(){ balls.push({x:canvas.width/2,y:canvas.height/2,color:ballColor.value,r:8}); }
function addGift(){ gifts.push({x:canvas.width/2,y:canvas.height/2+180,color:giftColor.value}); }
function resetAll(){ balls=[]; gifts=[]; }
function saveImage(){ const a=document.createElement('a'); a.download='christmas_tree.png'; a.href=canvas.toDataURL(); a.click(); }
function toggleMusic(){ const m=document.getElementById('music'); m.paused?m.play():m.pause(); }

canvas.onmousedown=e=>{ const mx=e.offsetX,my=e.offsetY;
  balls.forEach(b=>{ if(Math.hypot(mx-b.x,my-b.y)<b.r) dragging=b; });
  gifts.forEach(g=>{ if(mx>g.x&&mx<g.x+30&&my>g.y&&my<g.y+30) dragging=g; });
};
canvas.onmousemove=e=>{ if(dragging){ dragging.x=e.offsetX; dragging.y=e.offsetY; }};
canvas.onmouseup=()=>dragging=null;

function drawStar(cx,cy,r,color){
  ctx.save(); ctx.translate(cx,cy); ctx.beginPath();
  for(let i=0;i<5;i++){ ctx.lineTo(0,-r); ctx.rotate(Math.PI/5); ctx.lineTo(0,-r/2); ctx.rotate(Math.PI/5); }
  ctx.closePath(); ctx.fillStyle=color; ctx.globalAlpha=0.5+0.5*Math.sin(starBlink); ctx.fill(); ctx.restore();
}

function draw(){ ctx.clearRect(0,0,canvas.width,canvas.height);
  const cx=canvas.width/2, cy=canvas.height/2;
  ctx.fillStyle=trunkColor.value; ctx.fillRect(cx-20,cy+120,40,80);
  ctx.fillStyle = leafColor.value;
  // è–èª•æ¨¹ï¼šç”±ä¸Šåˆ°ä¸‹ï¼Œå°ä¸‰è§’å½¢åˆ°å¤§ä¸‰è§’å½¢
  const layers = [60, 100, 140, 180];
  layers.forEach((w, i) => {
    ctx.beginPath();
    ctx.moveTo(cx, cy - 220 + i * 70);
    ctx.lineTo(cx - w, cy - 120 + i * 70);
    ctx.lineTo(cx + w, cy - 120 + i * 70);
    ctx.closePath();
    ctx.fill();
  }); }
  // å¤šæ¢äº¤å‰å½©å¸¶
  ctx.strokeStyle = ribbonColor.value;
  ctx.lineWidth = 4;
  for (let i = -2; i <= 2; i++) {
    ctx.beginPath();
    ctx.moveTo(cx - 140, cy - 120 + i * 60);
    ctx.bezierCurveTo(cx - 40, cy - 60 + i * 60, cx + 40, cy - 20 + i * 60, cx + 140, cy + 20 + i * 60);
    ctx.stroke();
  }
  drawStar(cx,cy-200,15,starColor.value);
  balls.forEach(b=>{ ctx.fillStyle=b.color; ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fill(); });
  gifts.forEach(g=>{ ctx.fillStyle=g.color; ctx.fillRect(g.x,g.y,30,30);
    ctx.strokeStyle='red'; ctx.beginPath(); ctx.moveTo(g.x+15,g.y); ctx.lineTo(g.x+15,g.y+30); ctx.moveTo(g.x,g.y+15); ctx.lineTo(g.x+30,g.y+15); ctx.stroke(); });
  ctx.fillStyle='white'; snowflakes.forEach(s=>{ ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill(); s.y+=s.s; if(s.y>canvas.height){s.y=-5;s.x=Math.random()*canvas.width;} });
  starBlink+=0.05; requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
