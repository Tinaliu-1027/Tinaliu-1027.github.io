<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>æ—¥ç³»é¢¨æ ¼è–èª•æ¨¹ï¼ˆæ‰‹æ©Ÿï¼‹éŸ³æ¨‚å®Œæ•´ç‰ˆï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
body{
  margin:0;
  background:linear-gradient(#1c2b3a,#0f1824);
  overflow:hidden;
  touch-action:none;
  font-family:system-ui,-apple-system,sans-serif;
  color:white;
}
.controls{
  position:fixed;
  left:12px;
  top:12px;
  background:rgba(30,40,55,.78);
  padding:12px;
  border-radius:14px;
  font-size:13px;
  z-index:10;
}
button{
  margin-top:6px;
  padding:6px 10px;
  border-radius:10px;
  border:none;
  background:#ffe6b3;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="controls">
  <strong>ğŸ„ æ—¥ç³»è–èª•æ¨¹</strong><br>
  ğŸ‘‰ æ‹–å½©å¸¶ / å°çƒ<br>
  ğŸ‘‰ é»ç©ºç™½æ–°å¢å°çƒ<br>
  <button id="musicBtn">ğŸµ æ’­æ”¾éŸ³æ¨‚</button>
</div>

<!-- ğŸµ èƒŒæ™¯éŸ³æ¨‚ï¼ˆPixabay ç„¡ç‰ˆæ¬Šï¼‰ -->
<audio id="bgm" loop preload="auto">
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_3c7d3d0b2e.mp3" type="audio/mpeg">
</audio>

<canvas id="c"></canvas>

<script>
/* ========= åŸºæœ¬è¨­å®š ========= */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const CX = ()=>canvas.width/2;

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize(); addEventListener("resize",resize);

/* ========= ğŸµ éŸ³æ¨‚ï¼ˆé—œéµä¿®æ­£ï¼‰ ========= */
const bgm = document.getElementById("bgm");
const musicBtn = document.getElementById("musicBtn");
bgm.volume = 0.4;
let isPlaying = false;

musicBtn.addEventListener("click", () => {
  if (!isPlaying) {
    bgm.play().then(()=>{
      isPlaying = true;
      musicBtn.textContent = "â¸ æš«åœéŸ³æ¨‚";
    }).catch(()=>{
      alert("ç€è¦½å™¨é˜»æ“‹æ’­æ”¾ï¼Œè«‹å†é»ä¸€æ¬¡");
    });
  } else {
    bgm.pause();
    isPlaying = false;
    musicBtn.textContent = "ğŸµ æ’­æ”¾éŸ³æ¨‚";
  }
});

/* ========= ğŸŒ² æ¨¹åƒæ•¸ ========= */
const treeTop = 140;
const treeBottom = 380;
const maxWidth = 260;

function treeWidthAt(y){
  const t = (y-treeTop)/(treeBottom-treeTop);
  return maxWidth*(1-t*0.8);
}

/* ========= ğŸ€ å½©å¸¶ ========= */
const ribbons=[
  {y:240,offset:0},
  {y:290,offset:0},
  {y:340,offset:0}
];

/* ========= ğŸ”´ è£é£¾å°çƒ ========= */
const balls=[
  {x:-30,y:260,r:9},
  {x:40,y:300,r:10}
];

let dragging=null;
let dragType=null;
let moved=false;

/* ========= â­ äº”è§’æ˜Ÿ ========= */
let starPulse=1,dir=0.008;

/* ========= è§¸æ§ / æ»‘é¼ å…±ç”¨ ========= */
function getPos(e){
  if(e.touches){
    return {x:e.touches[0].clientX,y:e.touches[0].clientY};
  }
  return {x:e.offsetX,y:e.offsetY};
}

function start(e){
  e.preventDefault();
  moved=false;
  const {x,y}=getPos(e);

  ribbons.forEach(r=>{
    if(Math.abs(y-r.y)<14){
      dragging=r; dragType="ribbon";
    }
  });

  balls.forEach(b=>{
    if(Math.hypot(x-(CX()+b.x),y-b.y)<b.r+10){
      dragging=b; dragType="ball";
    }
  });
}

function move(e){
  if(!dragging) return;
  e.preventDefault();
  moved=true;
  const {x,y}=getPos(e);

  if(dragType==="ribbon") dragging.offset=x-CX();
  if(dragType==="ball"){
    dragging.x=x-CX();
    dragging.y=y;
  }
}

function end(e){
  if(!dragging && !moved){
    const {x,y}=getPos(e);
    if(y>treeTop && y<treeBottom){
      balls.push({x:x-CX(),y,r:8+Math.random()*3});
    }
  }
  dragging=null; dragType=null;
}

canvas.addEventListener("mousedown",start);
canvas.addEventListener("mousemove",move);
canvas.addEventListener("mouseup",end);
canvas.addEventListener("touchstart",start,{passive:false});
canvas.addEventListener("touchmove",move,{passive:false});
canvas.addEventListener("touchend",end);

/* ========= ç¹ªè£½ ========= */
function drawTree(){
  ctx.fillStyle="#5f8f7a";
  ctx.beginPath();
  ctx.moveTo(CX(),treeTop);
  ctx.bezierCurveTo(
    CX()-maxWidth/2,treeTop+80,
    CX()-maxWidth/2,treeBottom,
    CX(),treeBottom
  );
  ctx.bezierCurveTo(
    CX()+maxWidth/2,treeBottom,
    CX()+maxWidth/2,treeTop+80,
    CX(),treeTop
  );
  ctx.fill();
}

function drawRibbons(){
  ctx.strokeStyle="#f3d58a";
  ctx.lineWidth=5;
  ctx.lineCap="round";
  ribbons.forEach(r=>{
    const w=treeWidthAt(r.y)/2;
    ctx.beginPath();
    ctx.moveTo(CX()-w+r.offset*0.2,r.y);
    ctx.quadraticCurveTo(CX()+r.offset,r.y-12,CX()+w+r.offset*0.2,r.y);
    ctx.stroke();
  });
}

function drawBalls(){
  balls.forEach(b=>{
    ctx.fillStyle="#e38b7a";
    ctx.shadowColor="rgba(255,255,255,.6)";
    ctx.shadowBlur=8;
    ctx.beginPath();
    ctx.arc(CX()+b.x,b.y,b.r,0,Math.PI*2);
    ctx.fill();
  });
  ctx.shadowBlur=0;
}

function drawStar(){
  starPulse+=dir;
  if(starPulse>1.2||starPulse<0.9) dir*=-1;
  ctx.save();
  ctx.translate(CX(),treeTop-18);
  ctx.scale(starPulse,starPulse);
  ctx.fillStyle="#fff1a8";
  ctx.shadowColor="#fff1a8";
  ctx.shadowBlur=20;
  ctx.beginPath();
  for(let i=0;i<5;i++){
    ctx.lineTo(Math.cos((18+i*72)*Math.PI/180)*12,
               -Math.sin((18+i*72)*Math.PI/180)*12);
    ctx.lineTo(Math.cos((54+i*72)*Math.PI/180)*5,
               -Math.sin((54+i*72)*Math.PI/180)*5);
  }
  ctx.closePath();
  ctx.fill();
  ctx.restore();
}

/* ========= èƒŒæ™¯ ========= */
const snow=Array.from({length:120},()=>({
  x:Math.random()*innerWidth,
  y:Math.random()*innerHeight,
  s:Math.random()*0.4+0.2
}));

function drawBG(){
  ctx.fillStyle="white";
  snow.forEach(s=>{
    s.y+=s.s;
    if(s.y>canvas.height) s.y=0;
    ctx.beginPath();
    ctx.arc(s.x,s.y,1.2,0,Math.PI*2);
    ctx.fill();
  });
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawBG();
  drawStar();
  drawTree();
  drawRibbons();
  drawBalls();
  requestAnimationFrame(draw);
}
draw();
</script>

</body>
</html>
