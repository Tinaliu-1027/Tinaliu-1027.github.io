<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>å‰åœåŠ›é¢¨æ ¼è–èª•æ¨¹</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  background:linear-gradient(#1b2d3f,#0e1824);
  overflow:hidden;
  font-family:system-ui,-apple-system,sans-serif;
  color:white;
}
.controls{
  position:fixed;
  left:20px;
  top:20px;
  background:rgba(30,40,60,.78);
  padding:16px;
  border-radius:18px;
  font-size:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.5);
  z-index:10;
}
.controls label{display:block;margin-top:8px}
button{
  margin-top:10px;
  padding:6px 12px;
  border-radius:10px;
  border:none;
  background:#ffe4a8;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="controls">
  <strong>ğŸŒ² å‰åœåŠ›é¢¨æ ¼è–èª•æ¨¹</strong>
  <label>æ¨¹è‘‰ <input type="color" id="leaf" value="#5f8f7a"></label>
  <label>æœå¯¦ <input type="color" id="ball" value="#e07a5f"></label>
  <label>å¸ƒå¸¶ <input type="color" id="ribbon" value="#f2cc8f"></label>
  <label>æ˜Ÿéˆ <input type="color" id="star" value="#fff3b0"></label>
  <label>ç¦®ç‰© <input type="color" id="gift" value="#f4a6c1"></label>
  <button onclick="toggleMusic()">ğŸµ æ’­æ”¾ / æš«åœéŸ³æ¨‚</button>
  <button onclick="saveImage()">ğŸ“¸ å­˜æˆåœ–ç‰‡</button>
</div>

<!-- ğŸµ èƒŒæ™¯éŸ³æ¨‚ï¼ˆæ£®æ—ç³»ã€å‰åœåŠ›æ„Ÿï¼‰ -->
<audio id="bgm" loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_3c7d3d0b2e.mp3" type="audio/mpeg">
</audio>

<canvas id="c"></canvas>

<script>
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");
const CX=()=>canvas.width/2;

function resize(){
  canvas.width=innerWidth;
  canvas.height=innerHeight;
}
resize(); addEventListener("resize",resize);

const leaf=document.getElementById("leaf");
const ball=document.getElementById("ball");
const ribbon=document.getElementById("ribbon");
const star=document.getElementById("star");
const gift=document.getElementById("gift");

// ğŸµ éŸ³æ¨‚æ§åˆ¶
const bgm=document.getElementById("bgm");
bgm.volume=0.35;
let playing=false;

function toggleMusic(){
  if(!playing){
    bgm.play();
    playing=true;
  }else{
    bgm.pause();
    playing=false;
  }
}

// â­ æ˜Ÿéˆå‹•ç•«
let starPulse=1,dir=0.006;

// ğŸ æœå¯¦
const balls=[
  {x:-60,y:270,r:10},
  {x:30,y:310,r:9},
  {x:-10,y:350,r:11}
];

// ğŸ ç¦®ç‰©
const gifts=[
  {x:-60,y:470,w:42,h:30},
  {x:0,y:470,w:42,h:30},
  {x:60,y:470,w:42,h:30}
];

// â„ï¸ é›ª
const snow=Array.from({length:120},()=>({
  x:Math.random()*innerWidth,
  y:Math.random()*innerHeight,
  r:Math.random()*1.8+0.6,
  s:Math.random()*0.4+0.2
}));

// ğŸŒ¿ æ‰‹ç¹ªæ¨¹è‘‰
function softLeaf(y,w,h,color){
  ctx.fillStyle=color;
  ctx.shadowColor="rgba(0,0,0,.25)";
  ctx.shadowBlur=12;
  ctx.beginPath();
  ctx.moveTo(CX(),y-h);
  ctx.bezierCurveTo(CX()-w/2,y-h/2,CX()-w/2,y+h/2,CX(),y+h);
  ctx.bezierCurveTo(CX()+w/2,y+h/2,CX()+w/2,y-h/2,CX(),y-h);
  ctx.fill();
}

// ğŸŒŸ æ˜Ÿéˆ
function drawStarSpirit(){
  starPulse+=dir;
  if(starPulse>1.2||starPulse<0.85)dir*=-1;

  ctx.save();
  ctx.translate(CX(),140);
  ctx.scale(starPulse,starPulse);
  ctx.fillStyle=star.value;
  ctx.shadowColor=star.value;
  ctx.shadowBlur=40;
  ctx.beginPath();
  ctx.arc(0,0,14,0,Math.PI*2);
  ctx.fill();
  ctx.restore();
}

// ğŸ€ è´è¶çµ
function bow(x,y){
  ctx.fillStyle=ribbon.value;
  ctx.shadowBlur=6;
  ctx.beginPath();
  ctx.ellipse(x-6,y,7,5,0,0,Math.PI*2);
  ctx.ellipse(x+6,y,7,5,0,0,Math.PI*2);
  ctx.arc(x,y,3,0,Math.PI*2);
  ctx.fill();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  drawStarSpirit();

  softLeaf(200,170,70,leaf.value);
  softLeaf(260,230,80,"#4f7f6a");
  softLeaf(330,300,95,"#3f6f5a");

  // ğŸ€ å¸ƒå¸¶
  ctx.strokeStyle=ribbon.value;
  ctx.lineWidth=5;
  ctx.lineCap="round";
  [260,310,360].forEach(y=>{
    ctx.beginPath();
    ctx.moveTo(CX()-150,y);
    ctx.quadraticCurveTo(CX(),y-18,CX()+150,y);
    ctx.stroke();
  });

  // ğŸ æœå¯¦
  balls.forEach(b=>{
    ctx.fillStyle=ball.value;
    ctx.shadowColor="rgba(255,255,255,.5)";
    ctx.shadowBlur=10;
    ctx.beginPath();
    ctx.arc(CX()+b.x,b.y,b.r,0,Math.PI*2);
    ctx.fill();
  });

  // ğŸªµ æ¨¹å¹¹
  ctx.shadowBlur=0;
  ctx.fillStyle="#8d6b4f";
  ctx.fillRect(CX()-18,395,36,85);

  // ğŸ ç¦®ç‰©
  gifts.forEach(g=>{
    ctx.fillStyle=gift.value;
    ctx.shadowBlur=6;
    ctx.fillRect(CX()+g.x-g.w/2,g.y,g.w,g.h);
    bow(CX()+g.x,g.y-4);
  });

  // â„ï¸ é›ª
  ctx.fillStyle="white";
  snow.forEach(s=>{
    s.y+=s.s;
    if(s.y>canvas.height)s.y=0;
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  });

  requestAnimationFrame(draw);
}
draw();

// ğŸ“¸ å­˜æˆåœ–ç‰‡
function saveImage(){
  const a=document.createElement("a");
  a.download="ghibli-christmas-tree.png";
  a.href=canvas.toDataURL();
  a.click();
}
</script>

</body>
</html>
